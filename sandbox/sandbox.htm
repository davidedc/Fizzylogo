<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Fizzylogo sandbox</title>

  <link rel="stylesheet" href="./CodeMirror_files/docs.css">

  <link rel="stylesheet" href="./CodeMirror_files/codemirror.css">
  <script src="./CodeMirror_files/codemirror.js"></script>
  <script src="./CodeMirror_files/matchbrackets.js"></script>
  <script src="./CodeMirror_files/python.js"></script>
  <script src="./fizzylogo.js"></script>
  <style type="text/css">.CodeMirror {border: 1px solid black;}</style>
</head>

<body style="">
<div id="nav">
  <a href="http://google.com/"><h1>Fizzylogo</h1><img id="logo" src="./CodeMirror_files/logo.png"></a>

  <ul>
    <li><a href="http://google.com/">Link 1</a>
    </li><li><a href="http://google.com/">Link 2</a>
    </li><li><a href="http://google.com/">Link 3</a>
  </li></ul>
  <ul>
    <li><a href="http://google.com/">Link 4</a>
    </li><li><a class="active" href="http://google.com/">Link 5</a>
  </li></ul>
</div>

<article>
<h2>Fizzylogo</h2>

<div>

  <!-- left part, with code input and control buttons -->
  <div style="width: 49%; float: left;" >
    <textarea id="code" name="code" style="display: none;">console print 1+1</textarea>
    <button id="runAll"         onclick="return runAll();"        > run            </button>
    <button id="runSelection"   onclick="return runSelection();"  > run selection  </button>
    <button id="pauseOrRestart" onclick="return pauseOrRestart();"> pause          </button>
    <button id="stop"           onclick="return stop();"          > stop           </button>
  </div>


  <!-- right part, with the canvas and text output -->
  <div style="width: 49%; float: right;">

    <!--
    <div>
      <canvas id="myCanvas" width="330" height="326"></canvas>
    </div>
    -->
    <div>
      <textarea id="output" name="output" rows="23" cols="80" style="width:100%;margin-bottom:-5px;"></textarea>
    </div>
    <button id="clearOutput"           onclick="return clearOutput();"          > clear           </button>


  </div>

</div>

<script>

clearOutput = function(){
  document.getElementById("output").value = "code output ------------\n";
}

var paused = false;
var gen = null;
var timeoutNextStep = null;

pauseOrRestart = function(){
  if (!paused){
    paused = true;
    document.getElementById("pauseOrRestart").textContent = "restart";
    clearTimeout(timeoutNextStep);
    timeoutNextStep = null;
  }
  else {
    paused = false
    document.getElementById("pauseOrRestart").textContent = "pause";
    runFollowingSteps(gen);
  }
}

stop = function(){
  paused = false;
  document.getElementById("pauseOrRestart").textContent = "pause";
  disablePauseAndStopButtons();
  clearTimeout(timeoutNextStep);
  timeoutNextStep = null;
}

checkIfEmptySelection = function(){
  console.log("checking selection");
  if (editor.getSelection() == "") {
    document.getElementById("runSelection").disabled = true;
  }
  else {
    document.getElementById("runSelection").disabled = false;
  }
}

// have to givi it some time to get the proper content
// of the selection
checkInAMomentIfEmptySelection = function(){
  setTimeout(function(){ checkIfEmptySelection(); }, 10);
}

var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode: {name: "python",
         version: 3,
         singleLineStringErrors: false},
  lineNumbers: true,
  indentUnit: 2,
  matchBrackets: true
});
editor.on("beforeSelectionChange", checkInAMomentIfEmptySelection);

disablePauseAndStopButtons = function(){
  document.getElementById("pauseOrRestart").disabled = true;
  document.getElementById("stop").disabled = true;
}

enablePauseAndStopButtons = function(){
  document.getElementById("pauseOrRestart").disabled = false;
  document.getElementById("stop").disabled = false;
}


disablePauseAndStopButtons();
document.getElementById("runSelection").disabled = true;
Fizzylogo.init(document.getElementById("output"));
clearOutput()

runAll = function(){
  stop();

  gen = Fizzylogo.runOneStep(editor.getValue());
  runFollowingSteps(gen);
}

runSelection= function(){
  stop();

  gen = Fizzylogo.runOneStep(editor.getSelection());
  runFollowingSteps(gen);
}

runFollowingSteps = function(gen){
  done = gen.next().done;
  if (done) {
    disablePauseAndStopButtons();
  }
  else {
    enablePauseAndStopButtons();
    if (!paused) {
      timeoutNextStep = setTimeout(function(){ runFollowingSteps(gen); }, 0); }
    }
  }


</script>



  </article>
</body>
</html>